# 解析插件项目结构

在vscode插件开发环境搭建时，就运行了一个helloworld实例，以该源码部分的目录结构为例，介绍一下插件的项目结构。

```bash
.
├── .vscode
│   ├── launch.json     // 插件加载和调试的配置
│   └── tasks.json      // 配置TypeScript编译任务
├── .gitignore          // 忽略构建输出和node_modules文件
├── README.md           // 一个友好的插件文档
├── src
│   └── extension.ts    // 插件源代码
├── package.json        // 插件配置清单
├── tsconfig.json       // TypeScript配置
```

插件的关键部分： `package.json` 和 `extension.ts` 文件。

## 1. package.json文件

VS Code插件必须包含一个插件配置清单，package.json文件，它加入了一些Node.js字段和一些VS Code独有的字段。

```json
{
  "name": "helloworld",                       // 插件的名称，通常用小写字母，并且不能包含空格。
  "displayName": "helloworld",                 // 插件的显示名称，用于在 VS Code 的扩展市场中展示。
  "description": "this is a helloworld item",  // 插件的简要描述，介绍插件的功能。
  "version": "0.0.1",                          // 插件的版本号，遵循语义版本控制（SemVer）规则。
  "engines": {                                 // 指定兼容的 VS Code 版本。
    "vscode": "^1.107.0"
  },
  "categories": [                              // 插件在市场中的分类。
    "Other"
  ],
  "activationEvents": [],                      // 激活插件的事件，当特定事件触发时，插件会被激活。
  "main": "./out/extension.js",                // 插件的入口文件，VS Code 加载插件时首先执行的文件。
  "contributes": {                             // 插件的功能配置和贡献内容。
    "commands": [                               // 注册插件命令，使得用户可以在命令面板中访问
      {
        "command": "helloworld.helloWorld",   // 定义的命令标识符，用于与插件功能关联。
        "title": "Hello World"                 // 命令在命令面板中的显示名称。
      }
    ]
  },
  "scripts": {                                 // 定义可以在终端中运行的 npm 脚本。
    "vscode:prepublish": "npm run compile",    // 在发布前自动编译 TypeScript 代码。
    "compile": "tsc -p ./",                    // 编译 TypeScript 代码的命令。
    "watch": "tsc -watch -p ./",               // 监视文件变化并自动编译。
    "pretest": "npm run compile && npm run lint", // 在运行测试之前先编译和检查代码格式。
    "lint": "eslint src",                       // 检查 src 目录中的代码格式。
    "test": "vscode-test"                       // 运行 VS Code 的测试框架。
  },
  "devDependencies": {                         // 插件开发所需的依赖项。
    "@types/vscode": "^1.107.0",              // VS Code 的类型定义，供 TypeScript 使用。
    "@types/mocha": "^10.0.10",               // Mocha 的类型定义，用于单元测试。
    "@types/node": "22.x",                     // Node.js 的类型定义。
    "typescript-eslint": "^8.48.1",            // 用于将 TypeScript 与 ESLint 结合的包。
    "eslint": "^9.39.1",                       // JavaScript 和 TypeScript 的代码质量检查工具。
    "typescript": "^5.9.3",                    // TypeScript 的核心库。
    "@vscode/test-cli": "^0.0.12",            // VS Code 测试 CLI，简化测试运行。
    "@vscode/test-electron": "^2.5.2"         // 用于在 Electron 环境下测试的包。
  }
}
```

## 2. extension.ts文件

```typescript
// 模块 'vscode' 包含了 VS Code 扩展 API
// 导入该模块，并在以下代码中使用别名 vscode
import * as vscode from 'vscode';

// 当你的扩展被激活时调用此方法
// 当第一次执行命令时，你的扩展会被激活
export function activate(context: vscode.ExtensionContext) {

    // 使用控制台输出诊断信息 (console.log) 和错误 (console.error)
    // 这一行代码将在你的扩展被激活时仅执行一次
    console.log('恭喜你，扩展 "helloworld" 现在已激活！');

    // 命令已在 package.json 文件中定义
    // 现在通过 registerCommand 提供命令的实现
    // commandId 参数必须与 package.json 中的命令字段匹配
    const disposable = vscode.commands.registerCommand('helloworld.helloWorld', () => {
        // 你在这里放置的代码将在每次执行命令时被执行
        // 向用户显示消息框
        vscode.window.showInformationMessage('来自 helloworld 的 Hello World！');
    });

    context.subscriptions.push(disposable);
}

// 当你的扩展被停用时调用此方法
export function deactivate() {}
```

描述：

- `activate函数:` 当扩展首次被执行时，activate 函数被调用，注册并实现了一个名为 helloworld.helloWorld 的命令，该命令执行时展示一个信息框。
- `deactivate函数:` 在扩展被停用时执行。


# 常见的操作场景

## 1.1 菜单项


之前的案例执行VSCode插件命令是通过Ctrl+Shift+P打开命令行面板执行的。这里介绍一下使用菜单选项执行插件命令。

案例：menu


![alt text](image.png)


只修改package.json文件

```json
{
  "name": "menu",
  "displayName": "helloworld-menu",
  "description": "using menu launch commands",
  "version": "0.0.1",
  "engines": {
    "vscode": "^1.108.0"
  },
  "categories": [
    "Other"
  ],
  "activationEvents": [],
  "main": "./out/extension.js", // 插件代码入口
  "contributes": {
    "commands": [ // 这里存储所有的命令
      {
        "command": "menu.helloWorld",
        "title": "hello world" 
      },
      {
        "command": "menu.command1", // 命令实际执行的命令, 实际执行的代码在"main"对应的ts文件中。
        "title": "命令1"  // 
      },
      {
        "command": "menu.command2",
        "title": "命令2" 
      },
      {
        "command": "menu.command3",
        "title": "命令3" 
      },
      {
        "command": "menu.command4",
        "title": "命令4" 
      }
    ],
    "menus": {
      "explorer/context": [ // 插件出现的问题
        { // 导航栏菜单1
          "submenu": "test",
          "group": "navigation",
          "title": "子菜单名称"
        },
        { // 导航栏菜单2
          "submenu": "test1",
          "group": "navigation",
          "title": "子菜单名称1"
        }
      ],
      "test": [ // 导航栏菜单1包含的子命令
        {
          "command": "menu.command1",
          "group": "group1" // 对命令分类，同一类的不隔开
        },
        {
          "command": "menu.helloWorld",
          "group": "group1"
        },
        {
          "command": "menu.command2",
          "group": "group2"
        }
      ],
      "test1": [ // 导航栏菜单2包含的子命令
        {
          "command": "menu.command3",
          "group": "group1"
        },
        {
          "command": "menu.command4",
          "group": "group2"
        }
      ]
    },
    "submenus": [
      { // 将导航栏菜单记录进来
        "id": "test", // 导航栏菜单1包含的子命令
        "label": "菜单" // 显示为菜单栏的名称
      },
      {
        "id": "test1",
        "label": "菜单1"
      }
    ]
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "pretest": "npm run compile && npm run lint",
    "lint": "eslint src",
    "test": "vscode-test"
  },
  "devDependencies": {
    "@types/vscode": "^1.108.0",
    "@types/mocha": "^10.0.10",
    "@types/node": "22.x",
    "typescript-eslint": "^8.48.1",
    "eslint": "^9.39.1",
    "typescript": "^5.9.3",
    "@vscode/test-cli": "^0.0.12",
    "@vscode/test-electron": "^2.5.2"
  }
}

```

具体如下：

菜单, 对应的是test栏，里面包含命令1、hello world、和命令2，其中命令1和hello world同一个组，命令2单独一个组。

![image-20260110010412843](3.%E8%A7%A3%E6%9E%90%E6%8F%92%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.assets/image-20260110010412843.png)


菜单1, 对应的是test1栏，里面包含命令3和命令4，这两条命令不同组。

![image-20260110010431899](3.%E8%A7%A3%E6%9E%90%E6%8F%92%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.assets/image-20260110010431899.png)


### 1.1.1 细节描述

参考：https://blog.csdn.net/weixin_34234829/article/details/86133553

菜单出现的位置：

+ 资源管理器上下文菜单 - explorer/context -> `常见的`
+ 编辑器上下文菜单 - editor/context -> `常见的`
+ 编辑标题菜单栏 - editor/title
+ 编辑器标题上下文菜单 - editor/title/context
+ 调试callstack视图上下文菜单 - debug/callstack/context
+ SCM标题菜单 -scm/title
+ SCM资源组菜单 -scm/resourceGroup/context
+ SCM资源菜单 -scm/resource/context
+ SCM更改标题菜单 -scm/change/title
+ 左侧视图标题菜单 -view/title
+ 视图项菜单 -view/item/context
+ 控制命令是否显示在命令选项板中 - commandPalette

<br/>

不同的菜单拥有不同的默认分组，这些菜单支持的group如下：

editor/context
+ navigation- 放在这个组的永远排在最前面；
+ 1_modification - 更改组；
+ 9_cutcopypaste - 编辑组
+ z_commands - 最后一个默认组，其中包含用于打开命令选项板的条目。

<br/>

explorer/context有这些默认组：

+ navigation - 放在这个组的永远排在最前面；
+ 2_workspace - 与工作空间操作相关的命令。
+ 3_compare - 与差异编辑器中的文件比较相关的命令。
+ 4_search - 与在搜索视图中搜索相关的命令。
+ 5_cutcopypaste - 与剪切，复制和粘贴文件相关的命令。
+ 7_modification - 与修改文件相关的命令。

<br/>

在编辑器选项卡上下文菜单有这些默认组：

+ 1_close - 与关闭编辑器相关的命令。
+ 3_preview - 与固定编辑器相关的命令。

<br/>

在editor/title有这些默认组：

+ 1_diff - 与使用差异编辑器相关的命令。
+ 3_open - 与打开编辑器相关的命令。
+ 5_close - 与关闭编辑器相关的命令。

<br/>

具体可以见下图：

![image-20260110011256459](3.%E8%A7%A3%E6%9E%90%E6%8F%92%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.assets/image-20260110011256459.png)

<br/>