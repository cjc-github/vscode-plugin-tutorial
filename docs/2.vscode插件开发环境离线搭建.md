# VS Code插件开发离线环境搭建

在没有网络的环境下进行VS Code插件开发时，只能通过离线安装包来部署开发环境。

注意：如果存在内部npm, apt离线源的话，配置好离线源即可正常使用。


## 一、环境配置

运行环境：
- 操作系统：ubuntu22.04.1
- vscode： 1.107.1， 当前版本vscode推荐的Nodejs为22.21.1，因此下载Node.js对应的版本
- Node.js：22.21.1
- npm: 10.9.4

```bash
apt install -y node-typescript git curl

# node-typescript验证
tsc -v
```


### 1.1 下载Node.js

离线安装包：<https://nodejs.org/dist/v22.21.1/node-v22.21.1-linux-x64.tar.xz>

具体的命令行如下：

```bash
# 解压
tar -xvf node-v22.21.1-linux-x64.tar.xz
# 移动到合适位置
sudo mv node-v22.21.1-linux-x64 /usr/local/nodejs
# 创建符号链接以便全局使用
sudo ln -s /usr/local/nodejs/bin/node /usr/local/bin/node
sudo ln -s /usr/local/nodejs/bin/npm /usr/local/bin/npm
# 测试
node -v
npm -v
```


其实，到这里就应该配置内网源，或者将所需要的依赖包打包进去，依赖包打包进去的方式有2种：
- 全局安装
- 项目依赖安装


注意：

全局安装一般使用`npm install -g <xxx>`，这个安装目录在~/.nvm/versions/node/v22.21.1/lib/node_modules/

项目依赖安装使用`npm install <xxx>`，这个安装目录在当前项目的node_modules/目录下


下面介绍一下全局安装离线npm包如何操作


### 1.2 安装Yeoman和VS code扩展生成器


需要安装Yeoman和VS Code扩展生成器，在有网情况下可以使用npm进行安装，如下所示。

```bash
npm install -g yo generator-code
```

由于没有网络，因此下载离线安装包, 下面是对应的源码地址

<https://registry.npmmirror.com/generator-code/-/generator-code-1.11.16.tgz>

<https://registry.npmmirror.com/yo/-/yo-6.0.0.tgz>


具体的命令行如下：

```bash
# 查看全局依赖包
npm list -g --depth=0
# 安装的目录：~/.nvm/versions/node/v22.21.1/lib/node_modules/

# 卸载已有的依赖包
npm uninstall -g generator-code
npm uninstall -g yo

# 制作离线包 (有网的环境制作)

# 1、在有网环境安装这个
npm install -g npm-pack-all
# 2、下载yo和vscode扩展生成器
npm install -g yo generator-code

# 3、生成离线的tar.gz文件
cd ~/.nvm/versions/node/v22.21.1/lib/node_modules/

# 3.1 制作yo离线包
cd yo 
npm-pack-all
# 会生成yo-6.0.0.tgz

# 3.2 制作generator离线包
cd generator-code
npm-pack-all
# 会生成generator-code-1.11.16.tgz

# 使用离线包
npm install -g ./yo-6.0.0.tgz
npm install -g ./generator-code-1.11.16.tgz

# 验证
yo code
```

如果验证遇见问题的话，建议在有线环境下载，然后打包，将打包后的包在离线环境下解压运行。

```bash
# 1、在有网环境安装
npm install -g yo generator-code

# 2、打包
tar -czf generator-code-1.11.16.tgz generator-code/
tar -czf yo-6.0.0.tgz yo/

# 3、复制到离线环境
cd ~/.nvm/versions/node/v22.21.1/lib/node_modules/
mv path/to/generator-code-1.11.16.tgz .
mv path/to/yo-6.0.0.tgz .

# 4、解压到对应文件夹
tar -xzf generator-code-1.11.16.tgz
tar -xzf yo-6.0.0.tgz

# 5、验证
yo code
```

创建时，还是需要配置npm依赖源的，因此，到这里就无法执行了。